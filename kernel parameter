[main]
summary=Maximum server performance for MinIO

[vm]
transparent_hugepage=madvise

[sysfs]
/sys/kernel/mm/transparent_hugepage/defrag=defer+madvise
/sys/kernel/mm/transparent_hugepage/khugepaged/max_ptes_none=0

[cpu]
force_latency=1
governor=performance
energy_perf_bias=performance
min_perf_pct=100

[sysctl]
fs.xfs.xfssyncd_centisecs=72000
net.core.busy_read=50
net.core.busy_poll=50
kernel.numa_balancing=1

# Do not use swap at all
vm.swappiness=0
vm.vfs_cache_pressure=50

# Start writeback at 3% memory
vm.dirty_background_ratio=3
# Force writeback at 10% memory
vm.dirty_ratio=10

# Quite a few memory map
# areas may be consumed
vm.max_map_count=524288

# Default is 500000 = 0.5ms
kernel.sched_migration_cost_ns=5000000

# stalled hdd io threads
kernel.hung_task_timeout_secs=85

# network tuning for bigger throughput
net.core.netdev_max_backlog=250000
net.ipv4.tcp_syncookies=0
net.ipv4.tcp_max_syn_backlog=65535
net.core.wmem_max=4194304
net.core.rmem_max=4194304
net.core.rmem_default=4194304
net.core.wmem_default=4194304
net.ipv4.tcp_rmem="4096 87380 4194304"
net.ipv4.tcp_wmem="4096 65536 4194304"

# Reduce CPU utilization
net.ipv4.tcp_timestamps=0

# Increase throughput
net.ipv4.tcp_sack=1

# Low latency mode for TCP
net.ipv4.tcp_low_latency=1

# The following variable is used to tell the kernel how 
# much of the socket buffer space should be used for TCP 
# window size, and how much to save for an application buffer.
net.ipv4.tcp_adv_win_scale=1

# disable RFC2861 behavior
net.ipv4.tcp_slow_start_after_idle = 0

# Fix faulty network setups
net.ipv4.tcp_mtu_probing=1
net.ipv4.tcp_base_mss=1280

# Disable ipv6
net.ipv6.conf.all.disable_ipv6=1
net.ipv6.conf.default.disable_ipv6=1
net.ipv6.conf.lo.disable_ipv6=1

# FIN_WAIT timeout set to 20s
net.ipv4.tcp_fin_timeout=20

# change local port range to use max
net.ipv4.ip_local_port_range=1024 65535

# Set maximum tracked connections (800k)
net.netfilter.nf_conntrack_max=800000

# Set hash table size (nf_conntrack_max / 8 = 100k buckets)
net.netfilter.nf_conntrack_buckets=100000

# Reduce timeouts to clear connections faster
net.netfilter.nf_conntrack_tcp_timeout_established=300
net.netfilter.nf_conntrack_tcp_timeout_close_wait=20

# All conn wait states set to 20s max, to avoid
# lingering around on a busy system, increasing
# these values further might cause network
# disconnections due to high number of TIME_WAIT
# or FIN_WAIT build-up to avoid that set the
# values lower so that the kernel can reclaim
# them faster, very useful on 400G like systems.
net.netfilter.nf_conntrack_tcp_timeout_fin_wait=20
net.netfilter.nf_conntrack_tcp_timeout_syn_recv=20
net.netfilter.nf_conntrack_tcp_timeout_syn_sent=20
net.netfilter.nf_conntrack_tcp_timeout_time_wait=20
net.netfilter.nf_conntrack_udp_timeout=30
net.netfilter.nf_conntrack_udp_timeout_stream=60
net.netfilter.nf_conntrack_icmp_timeout=10

[bootloader]
# Avoid firing timers for all CPUs at the same time. This is irrelevant for
# full nohz systems
cmdline=skew_tick=1




[vm] 메모리 관리
transparent_hugepage = madvise

THP를 앱 요청 시에만 사용하여 예기치 못한 지연을 줄이고 메모리 효율을 확보.
[sysfs] THP 세부 설정
/sys/kernel/mm/transparent_hugepage/defrag = defer+madvise

메모리 결합(defrag)을 지연시키고 앱이 요청할 경우에만 수행.
/sys/kernel/mm/transparent_hugepage/khugepaged/max_ptes_none = 0

빈 PTE가 포함된 페이지는 결합하지 않음 → 불필요한 stall 방지.
[cpu] CPU 주파수/전원 정책
force_latency = 1

레이턴시 최적화 모드 활성화.
governor = performance

CPU 클럭을 성능 위주로 고정.
energy_perf_bias = performance

EPP를 성능 우선으로 설정.
min_perf_pct = 100

최소 성능 비율 100% 유지.
[sysctl] 파일시스템/NUMA/네트워크/VM 설정
fs.xfs.xfssyncd_centisecs = 72000

XFS 동기화 주기를 12분으로 늘려 백그라운드 부하 완화.
net.core.busy_read = 50, net.core.busy_poll = 50

NAPI busy-polling으로 지연 감소.
kernel.numa_balancing = 1

NUMA 메모리 자동 밸런싱 활성화.
vm.swappiness = 0

스왑 사용 금지.
vm.vfs_cache_pressure = 50

캐시를 오래 유지.
vm.dirty_background_ratio = 3, vm.dirty_ratio = 10

쓰기 스톰 방지.
vm.max_map_count = 524288

메모리 매핑 상한 확대.
kernel.sched_migration_cost_ns = 5000000

코어 간 태스크 이동 억제.
kernel.hung_task_timeout_secs = 85

hung task 탐지 타임아웃 연장.
네트워크 성능 튜닝
net.core.netdev_max_backlog = 250000

NIC 백로그 큐 확장.
net.ipv4.tcp_syncookies = 0

SYN cookies 비활성화(성능↑, 보안↓).
net.ipv4.tcp_max_syn_backlog = 65535

SYN 큐 확장.
net.core.wmem_max / rmem_max = 4194304

소켓 버퍼 최대값 4MiB.
net.ipv4.tcp_rmem = 4096 87380 4194304, tcp_wmem = 4096 65536 4194304

TCP 버퍼 최소/기본/최대값 설정.
net.ipv4.tcp_timestamps = 0

타임스탬프 비활성화.
net.ipv4.tcp_sack = 1

선택적 확인응답(SACK) 활성화.
net.ipv4.tcp_low_latency = 1

TCP 저지연 모드.
net.ipv4.tcp_adv_win_scale = 1

TCP 윈도/앱 버퍼 비율 조정.
net.ipv4.tcp_slow_start_after_idle = 0

유휴 후 슬로 스타트 비활성화.
net.ipv4.tcp_mtu_probing = 1, tcp_base_mss = 1280

MTU 문제 시 MSS 조정.
net.ipv6.conf.*.disable_ipv6 = 1

IPv6 비활성화.
net.ipv4.tcp_fin_timeout = 20

FIN_WAIT2 타임아웃 단축.
net.ipv4.ip_local_port_range = 1024 65535

에페메럴 포트 범위 최대화.
conntrack
nf_conntrack_max = 800000

최대 연결 추적 수.
nf_conntrack_buckets = 100000

해시 버킷 수.
nf_conntrack_tcp_timeout_ / udp_timeout / icmp_timeout*

연결 추적 타임아웃 단축으로 자원 회수 가속.
[bootloader] 부트로더 옵션
cmdline = skew_tick=1

CPU 타이머 틱 오프셋을 적용해 인터럽트 피크 분산
